# Problem 4 Solution: Ambiguity Proof

## Problem Statement
Show that the following grammar is ambiguous, but that the language it generates is not inherently ambiguous.

**Grammar:**
```
S → aSb | SS | λ
```

## Part A: Prove the Grammar is Ambiguous

### Definition
A grammar is ambiguous if there exists at least one string that has two or more distinct derivation trees.

### Proof

We will demonstrate ambiguity by showing that the string "aabb" has two different derivation trees.

#### Derivation Tree 1

```
        S
       /|\
      / | \
     S  S  λ
    /|\ |
   / | \|
  a  S  b S
     |   /|\
     λ  / | \
       a  S  b
          |
          λ
```

Reading left-to-right: a λ b a λ b = aabb ✓

**Leftmost derivation for Tree 1:**
```
S ⇒ SS             [S → SS]
  ⇒ aSbS           [S → aSb on left S]
  ⇒ abS            [S → λ on middle S]
  ⇒ abaSb          [S → aSb on right S]
  ⇒ abaλb          [S → λ]
  ⇒ aabb
```

#### Derivation Tree 2

```
        S
       /|\
      / | \
     a  S  b
        |
        S  S
       /|\ |
      / | \|
     a  S  b λ
        |
        λ
```

Reading left-to-right: a a λ b λ b = aabb ✓

**Leftmost derivation for Tree 2:**
```
S ⇒ aSb            [S → aSb]
  ⇒ aSSb           [S → SS on middle S]
  ⇒ aaSbSb         [S → aSb on left S]
  ⇒ aaλbSb         [S → λ]
  ⇒ aabSb
  ⇒ aabλb          [S → λ]
  ⇒ aabb
```

### Conclusion Part A
Since the string "aabb" has two structurally different derivation trees (the trees differ in structure, not just in the order of applying productions), the grammar is **ambiguous**. ✓

## Part B: Prove the Language is NOT Inherently Ambiguous

### Definition
A language is inherently ambiguous if every grammar that generates it is ambiguous. Equivalently, a language is NOT inherently ambiguous if there exists at least one unambiguous grammar for it.

### Strategy
To prove the language is not inherently ambiguous, we must:
1. Identify what language the grammar generates
2. Construct an equivalent unambiguous grammar

### Step 1: Identify the Language

The language generated by S → aSb | SS | λ is:

**L = {w ∈ {a,b}* : n_a(w) = n_b(w) and n_a(v) ≥ n_b(v) for every prefix v of w}**

This is the language of balanced parentheses if we think of 'a' as '(' and 'b' as ')'.

Alternative characterization: L is the language of properly matched parentheses structures.

### Step 2: Construct an Unambiguous Grammar

Here is an unambiguous grammar for the same language:

```
S → aSbS | λ
```

**Explanation:**
- This grammar forces a specific structure
- Each 'a' is immediately followed (eventually) by a matching 'b'
- The second S after 'b' allows for concatenation of multiple balanced substrings
- There is only one way to parse any string with this grammar

### Proof that the New Grammar is Unambiguous

**Claim:** The grammar G' = {S → aSbS | λ} is unambiguous.

**Proof:**
For any string w ∈ L(G'), we will show there is a unique derivation tree.

**By induction on the length of w:**

**Base case:** |w| = 0
- Only derivation: S ⇒ λ
- Unique derivation tree ✓

**Inductive case:** |w| > 0
- If w ∈ L(G') and |w| > 0, then w must start with 'a' (since the only non-empty production is S → aSbS)
- Find the matching 'b' for this first 'a' - let's say w = a w₁ b w₂
  - w₁ is a balanced substring (all parentheses within w₁ are matched within w₁)
  - w₂ is also a balanced substring
- By the inductive hypothesis, w₁ and w₂ each have unique derivation trees
- The only way to derive w is: S ⇒ aSbS ⇒* aw₁bw₂
- Therefore, w has a unique derivation tree ✓

By induction, every string in L(G') has a unique derivation tree, so G' is unambiguous.

### Step 3: Prove G and G' Generate the Same Language

**Claim:** L(G) = L(G') where G has productions S → aSb | SS | λ and G' has productions S → aSbS | λ

**Proof sketch:**

**(⊆) L(G') ⊆ L(G):**
- Any derivation in G' can be simulated in G
- S ⇒_G' aSbS can be simulated as S ⇒_G aSb followed by ⇒_G SS
- Therefore L(G') ⊆ L(G) ✓

**(⊇) L(G) ⊆ L(G'):**
- We need to show every string generated by G can be generated by G'
- Both grammars generate strings with equal a's and b's satisfying the prefix property
- The key insight: The production S → SS in G allows parallel composition, while S → aSbS in G' allows sequential composition after each matched pair
- These are equivalent for balanced strings
- Therefore L(G) ⊆ L(G') ✓

Hence L(G) = L(G').

### Conclusion Part B

Since we have constructed an unambiguous grammar G' that generates the same language as G, the language is **NOT inherently ambiguous**. ✓

## Final Answer Summary

1. **The grammar S → aSb | SS | λ is ambiguous** because the string "aabb" (among others) has multiple distinct derivation trees.

2. **The language is NOT inherently ambiguous** because there exists an equivalent unambiguous grammar: S → aSbS | λ.

This completes the proof.

## Additional Notes

This problem is referenced in the textbook:
- Example 5.4 introduces this grammar
- Example 5.10 shows its ambiguity
- Exercise 18 in Section 5.2 asks to prove this specific result

The key insight is that ambiguity is a property of grammars, while inherent ambiguity is a property of languages. A language may have both ambiguous and unambiguous grammars.
